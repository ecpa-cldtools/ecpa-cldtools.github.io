/** Functions and helpers */

function appVersion() {
  var version = "0.0.2";
  console.log("CldMediaInspectorTool Version", version);
}

function parseQuery(query) {
  var Params = new Object();
  if (!query) return Params; // return empty object
  var Pairs = query.split(/[;&]/);
  for (var i = 0; i < Pairs.length; i++) {
    var KeyVal = Pairs[i].split("=");
    if (!KeyVal || KeyVal.length != 2) continue;
    var key = decodeURI(KeyVal[0]);
    var val = decodeURI(KeyVal[1]);
    val = val.replace(/\+/g, " ");
    Params[key] = val;
  }
  return Params;
}

/** Processor methods */

function getAllImageSrc() {
  var queryString = "?";
  var imgSrcs = document.getElementsByTagName("img");
  for (i = 0; i < imgSrcs.length; i++) {
    if (i < 1) {
      queryString += "imgsrc" + i.toString() + "=" + imgSrcs[i].src;
    } else {
      if (queryString.length + imgSrcs[i].src.length + 15) {
        queryString += "&amp;imgsrc" + i.toString() + "=" + imgSrcs[i].src;
      }
    }
  }

  return queryString;
}

function appMain() {
  let script = document.currentScript;
  let myScript = script.getAttribute("src") + getAllImageSrc();

  var queryString = myScript.replace(/^[^\?]+\??/, "");

  console.log("myScript", myScript);
  console.log("queryString", queryString);
  console.log("Params", parseQuery(queryString));
}

/***********************************/
/** Main() */

// Call out the current version
appVersion();

appMain();
